buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "gradle.plugin.org.jruyi.gradle:thrift-gradle-plugin:0.3.1"
    }
}

apply plugin: "org.jruyi.thrift"

dependencies {
    compile 'org.apache.thrift:libthrift:0.9.3'
}

task cleanGeneratedFile(type: Delete) {
    delete 'thrift/gen'
}

compileThrift {
    dependsOn 'cleanGeneratedFile'
    sourceDir 'thrift'
    outputDir 'thrift/gen'
    createGenFolder false
    generator 'java', 'html'
}

task copyGeneratedFile {
    dependsOn 'compileThrift'

    group = 'thrift'
    description = 'copy thrift generated files to coreponding service-provider-directories'

    def copySpecs = [
            [thrift: 'companyfollowers', service: 'demo-service-provider']
    ]

    String commonBase = 'thrift/gen/com/moseeker/thrift/gen/',
           targetBase = 'src/main/java/com/moseeker/thrift/gen/';
    def mappings = copySpecs.collect {
        String from = commonBase + it.thrift
        String into = '../' + it.service + "/" + targetBase + it.thrift
        return [from: from, into: into]
    }

    def mappingsServiceManager = [from: "thrift/gen/", into: "../service-manager/src/main/java/"]

    doLast {
        copy {
            mappings.each {
                from it.from
                into it.into
            }
        }

        copy {
            from mappingsServiceManager.from
            into mappingsServiceManager.into
        }
        logger.quiet("ends of copy file")
    }
}

project.description = '''
    all thrfit IDL definitions.
'''